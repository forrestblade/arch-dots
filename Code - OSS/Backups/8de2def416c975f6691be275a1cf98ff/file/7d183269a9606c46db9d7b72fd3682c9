file:///home/loki/Projects/js/web/puppeteer-jest/src/__tests__/integration/integration.test.js {"mtime":1567046552361,"size":1733,"etag":"33odlheld1os","orphaned":false}
/* eslint-env jest */
const puppeteer = require('puppeteer')

describe('Counter', () => {
  let page, browser

  beforeAll(async () => {
    browser = await puppeteer.launch({ headless: false})
    page = await browser.newPage()
    await page.setViewport({ width: 900, height: 800 })
    await page.goto('https://salescentercert2.deere.com', {waitUntil: "networkidle0"})
    jest.setTimeout(45000)
  })

  afterAll(async () => {
    browser.close()
  })

 
 it('should sign into the test account', async () => {
   const expectedEndpoint = 'https://salescentercert2.deere.com/#/dashboard/home/all-activities'  
  
   await page.waitForSelector('#okta-signin-username');
   await page.click('#okta-signin-username');
   await page.keyboard.type('xxx');
   await page.click('#okta-signin-password');
   await page.keyboard.type('xxx');
   await page.click('#okta-signin-submit');
   await page.waitFor(7000);
   await page.click('.buttons-module-agreeButton-EGKQY');
   await page.waitFor(7000);

   expect(page.url()).toBe(expectedEndpoint)
 })
 
  
  it('should naviagte to the equipment tab and create a new quote by adding a machine', async () => {
    const tabs = await page.$$('a.icon-home');

    await tabs[2].click()
    await await page.waitFor(7000);

    await page.waitForSelector('.primary-button-module-primaryButton-IGJoi');
    await page.click('.primary-button-module-primaryButton-IGJoi');
    await page.click('.actions-menu-item');
    await page.waitForSelector('.modal-body');
    await page.click('[data-testid="primary-button"]');
    await page.waitForSelector('input.editable-input');
    const untitledQuote = await page.$eval('input.editable-input', input => input.value);

    expect(untitledQuote).toEqual('Untitled Quote')
  })
  
})
